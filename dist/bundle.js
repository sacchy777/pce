!function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),i(1);const e=i(6);class h{constructor(t){this._game=t}setup(){this.gameLoop()}gameLoop(){requestAnimationFrame(this.gameLoop.bind(this)),this._game.render()}}window.onload=(()=>{new h(new e.default).setup()})},function(t,s,i){var e=i(2);"string"==typeof e&&(e=[[t.i,e,""]]);var h={hmr:!0,transform:void 0,insertInto:void 0};i(4)(e,h);e.locals&&(t.exports=e.locals)},function(t,s,i){(t.exports=i(3)(!1)).push([t.i,"html, body {\r\n    overflow: hidden;\r\n    position: fixed;\r\n    width: 100%;\r\n    height: 100%;\r\n    margin: 0px;\r\n    padding: 0px;\r\n}\r\ncanvas {\r\n    -webkit-tap-highlight-color : transparent;\r\n}\r\n",""])},function(t,s,i){"use strict";t.exports=function(t){var s=[];return s.toString=function(){return this.map(function(s){var i=function(t,s){var i=t[1]||"",e=t[3];if(!e)return i;if(s&&"function"==typeof btoa){var h=(r=e,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),a=e.sources.map(function(t){return"/*# sourceURL="+e.sourceRoot+t+" */"});return[i].concat(a).concat([h]).join("\n")}var r;return[i].join("\n")}(s,t);return s[2]?"@media "+s[2]+"{"+i+"}":i}).join("")},s.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var e={},h=0;h<this.length;h++){var a=this[h][0];null!=a&&(e[a]=!0)}for(h=0;h<t.length;h++){var r=t[h];null!=r[0]&&e[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),s.push(r))}},s}},function(t,s,i){var e,h,a={},r=(e=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===h&&(h=e.apply(this,arguments)),h}),c=function(t){var s={};return function(t,i){if("function"==typeof t)return t();if(void 0===s[t]){var e=function(t,s){return s?s.querySelector(t):document.querySelector(t)}.call(this,t,i);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}s[t]=e}return s[t]}}(),d=null,l=0,_=[],o=i(5);function n(t,s){for(var i=0;i<t.length;i++){var e=t[i],h=a[e.id];if(h){h.refs++;for(var r=0;r<h.parts.length;r++)h.parts[r](e.parts[r]);for(;r<e.parts.length;r++)h.parts.push(k(e.parts[r],s))}else{var c=[];for(r=0;r<e.parts.length;r++)c.push(k(e.parts[r],s));a[e.id]={id:e.id,refs:1,parts:c}}}}function f(t,s){for(var i=[],e={},h=0;h<t.length;h++){var a=t[h],r=s.base?a[0]+s.base:a[0],c={css:a[1],media:a[2],sourceMap:a[3]};e[r]?e[r].parts.push(c):i.push(e[r]={id:r,parts:[c]})}return i}function p(t,s){var i=c(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var e=_[_.length-1];if("top"===t.insertAt)e?e.nextSibling?i.insertBefore(s,e.nextSibling):i.appendChild(s):i.insertBefore(s,i.firstChild),_.push(s);else if("bottom"===t.insertAt)i.appendChild(s);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var h=c(t.insertAt.before,i);i.insertBefore(s,h)}}function b(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var s=_.indexOf(t);s>=0&&_.splice(s,1)}function m(t){var s=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var e=function(){0;return i.nc}();e&&(t.attrs.nonce=e)}return g(s,t.attrs),p(t,s),s}function g(t,s){Object.keys(s).forEach(function(i){t.setAttribute(i,s[i])})}function k(t,s){var i,e,h,a;if(s.transform&&t.css){if(!(a="function"==typeof s.transform?s.transform(t.css):s.transform.default(t.css)))return function(){};t.css=a}if(s.singleton){var r=l++;i=d||(d=m(s)),e=y.bind(null,i,r,!1),h=y.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var s=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(s,t.attrs),p(t,s),s}(s),e=function(t,s,i){var e=i.css,h=i.sourceMap,a=void 0===s.convertToAbsoluteUrls&&h;(s.convertToAbsoluteUrls||a)&&(e=o(e));h&&(e+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(h))))+" */");var r=new Blob([e],{type:"text/css"}),c=t.href;t.href=URL.createObjectURL(r),c&&URL.revokeObjectURL(c)}.bind(null,i,s),h=function(){b(i),i.href&&URL.revokeObjectURL(i.href)}):(i=m(s),e=function(t,s){var i=s.css,e=s.media;e&&t.setAttribute("media",e);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),h=function(){b(i)});return e(t),function(s){if(s){if(s.css===t.css&&s.media===t.media&&s.sourceMap===t.sourceMap)return;e(t=s)}else h()}}t.exports=function(t,s){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(s=s||{}).attrs="object"==typeof s.attrs?s.attrs:{},s.singleton||"boolean"==typeof s.singleton||(s.singleton=r()),s.insertInto||(s.insertInto="head"),s.insertAt||(s.insertAt="bottom");var i=f(t,s);return n(i,s),function(t){for(var e=[],h=0;h<i.length;h++){var r=i[h];(c=a[r.id]).refs--,e.push(c)}t&&n(f(t,s),s);for(h=0;h<e.length;h++){var c;if(0===(c=e[h]).refs){for(var d=0;d<c.parts.length;d++)c.parts[d]();delete a[c.id]}}}};var u,w=(u=[],function(t,s){return u[t]=s,u.filter(Boolean).join("\n")});function y(t,s,i,e){var h=i?"":e.css;if(t.styleSheet)t.styleSheet.cssText=w(s,h);else{var a=document.createTextNode(h),r=t.childNodes;r[s]&&t.removeChild(r[s]),r.length?t.insertBefore(a,r[s]):t.appendChild(a)}}},function(t,s){t.exports=function(t){var s="undefined"!=typeof window&&window.location;if(!s)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=s.protocol+"//"+s.host,e=i+s.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,s){var h,a=s.trim().replace(/^"(.*)"$/,function(t,s){return s}).replace(/^'(.*)'$/,function(t,s){return s});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?t:(h=0===a.indexOf("//")?a:0===a.indexOf("/")?i+a:e+a.replace(/^\.\//,""),"url("+JSON.stringify(h)+")")})}},function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});const e=256,h=224,a=i(7);class r{constructor(){this.height=window.innerHeight,this.width=window.innerWidth,this.quit=(t=>{}),this.resize=(t=>{this.init()}),this.load=(t=>{t.preventDefault(),t.stopPropagation();let s=t.dataTransfer.files[0],i=new FileReader;i.onload=(()=>{let t=i.result,s=new Uint8Array(t),e=Array.from(s);this.pce.load(e)}),i.readAsArrayBuffer(s)}),this.dragover=(t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy"}),this.keyup=(t=>{"F2"==t.key&&(this.info_mode!=r.INFO_MODE_DEBUG?this.info_mode=r.INFO_MODE_DEBUG:this.info_mode=r.INFO_MODE_NONE),"F8"==t.key&&(this.show_fps=!this.show_fps),"F9"==t.key&&(this.colormode==r.COLOR_MODE_LIGHT?this.colormode=r.COLOR_MODE_DARK:this.colormode=r.COLOR_MODE_LIGHT),"ArrowLeft"==t.key&&this.pce.gamepad_LEFT_off(),"ArrowRight"==t.key&&this.pce.gamepad_RIGHT_off(),"ArrowUp"==t.key&&this.pce.gamepad_UP_off(),"ArrowDown"==t.key&&this.pce.gamepad_DOWN_off(),"z"==t.key&&this.pce.gamepad_A_off(),"x"==t.key&&this.pce.gamepad_B_off(),"c"==t.key&&this.pce.gamepad_START_off(),"v"==t.key&&this.pce.gamepad_SELECT_off()}),this.keydown=(t=>{"ArrowLeft"==t.key&&this.pce.gamepad_LEFT_on(),"ArrowRight"==t.key&&this.pce.gamepad_RIGHT_on(),"ArrowUp"==t.key&&this.pce.gamepad_UP_on(),"ArrowDown"==t.key&&this.pce.gamepad_DOWN_on(),"z"==t.key&&this.pce.gamepad_A_on(),"x"==t.key&&this.pce.gamepad_B_on(),"c"==t.key&&this.pce.gamepad_START_on(),"v"==t.key&&this.pce.gamepad_SELECT_on()}),this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.tempcanvas=document.getElementById("tempcanvas"),this.tempctx=this.tempcanvas.getContext("2d"),this.tempcanvas.width=r.screenW,this.tempcanvas.height=r.screenH,this.ctx.imageSmoothingEnabled=!0,this.screenbuffer=this.ctx.createImageData(r.screenW,r.screenH),this.ratio=this.height/e,this.ticks=0,this.show_fps=!1,this.colormode=r.COLOR_MODE_LIGHT,this.info_mode=r.INFO_MODE_NONE,this.fpstime=new Array(r.FPS_INTERVAL),this.fpstime.fill(0),this.fpsindex=0,this.init(),this.gameinit(),window.addEventListener("beforeunload",this.quit),window.addEventListener("resize",this.resize),window.addEventListener("drop",this.load),window.addEventListener("dragover",this.dragover),window.addEventListener("keyup",this.keyup),window.addEventListener("keydown",this.keydown)}init(){this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.width>this.height?this.ratio=this.height/e:this.ratio=this.width/h}gameinit(){this.pce=new a.System}specfont(t,s){let i=t*this.ratio;this.ctx.font=i+"px 'Consolas'",this.ctx.fillStyle=s}drawtext(t,s,i){this.ctx.fillText(t,s*this.ratio,i*this.ratio)}drawdebug(){if(this.pce.is_ready()||(this.specfont(12,"black"),this.drawtext("drop pce rom image here",50,100),this.specfont(6,"black"),this.drawtext("[Keys]",50,120),this.drawtext("F2:debug F8:fps",50,130),this.drawtext("Z:I X:II C:RUN V:SEL Arrows:D-pad",50,140)),this.pce.is_ready()&&(this.pce.fill_screen(0,8,r.screenW,r.screenH,this.screenbuffer.data),this.tempctx.putImageData(this.screenbuffer,0,0),this.ctx.drawImage(this.tempcanvas,0,0,r.screenW*this.ratio,r.screenH*this.ratio)),this.info_mode==r.INFO_MODE_DEBUG){let t=(this.pce.cpu.dump_get_text()+"\n"+this.pce.gpu.dump_get_text()+"\n\n"+this.pce.psg.dump_get_text()).split("\n");this.colormode==r.COLOR_MODE_LIGHT?this.specfont(6,"lightgreen"):this.specfont(6,"darkgreen");for(let s=0;s<t.length;s++)this.ctx.fillText(t[s],0*this.ratio,5*s*this.ratio)}if(this.show_fps){let t=this.fpstime[(this.fpsindex-1+r.FPS_INTERVAL)%r.FPS_INTERVAL]-this.fpstime[this.fpsindex],s=Math.floor(r.FPS_INTERVAL/(t/1e3));isNaN(s)&&(s=0),this.colormode==r.COLOR_MODE_LIGHT?this.specfont(6,"lightgreen"):this.specfont(6,"darkgreen"),this.ctx.fillText("FPS "+s,200*this.ratio,10*this.ratio)}}process(){this.pce.is_ready()&&this.pce.run(16.6666667)}render(){this.process(),this.ticks++,this.ctx.clearRect(0,0,this.width,this.height),this.drawdebug(),this.fpstime[this.fpsindex]=Date.now(),this.fpsindex=(this.fpsindex+1)%r.FPS_INTERVAL}}r.screenW=256,r.screenH=224,r.debug=!1,r.FPS_INTERVAL=30,r.COLOR_MODE_LIGHT=0,r.COLOR_MODE_DARK=0,r.INFO_MODE_NONE=0,r.INFO_MODE_DEBUG=1,r.INFO_MODE_HELP=2,s.default=r},function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});class e{constructor(){e.error=""}static d(t){e.error+=t}}s.Log=e;class h{static hex(t,s=2){return("00000000"+t.toString(16)).slice(-s)}}s.Util=h;class a{constructor(){this.error=!1,this.errorLog="",this.memory=null,this.offset=a.DEFAULT_HEADERSIZE}read(t){return this.memory?this.memory[t+this.offset]:(this.errorLog+="ROM not loaded\n",0)}write(t,s){this.memory?(this.errorLog+="Error writing ROM "+s+" at "+t+"\n",this.error=!0):this.errorLog+="ROM not loaded\n"}length(){return null==this.memory?0:this.memory.length}attach(t){this.memory=t,this.offset=4095&this.length()}}a.DEFAULT_HEADERSIZE=512,s.ROM=a;class r{constructor(t=r.DEFAULTSIZE){this.size=t,this.memory=new Array(t),this.memory.fill(0),this.error=!1,this.errorLog=""}read(t){return this.memory[t]}write(t,s){this.memory[t]=s}length(){return this.memory.length}}r.DEFAULTSIZE=8192,s.RAM=r;class c{constructor(){this.period=0,this.enable=0,this.counter=0,this.countermax=0,this.interrupt=!1}read(t){let s="[Timer] read @"+t+" ";switch(t){case 0:return this.period;case 1:return this.enable}c.debug&&console.log(s)}write(t,s){let i="[Timer] write @"+t+" ";switch(t){case 0:this.period=127&s,i+="period="+this.period,this.countermax=1023*this.period,0==this.countermax&&(this.countermax=1023);break;case 1:this.enable=1&s,i+="enable="+this.enable}c.debug&&console.log(i)}exec(t=1){0!=this.enable&&(this.counter=this.counter+t,this.counter>this.countermax&&(this.counter=this.counter-this.countermax,this.interrupt=!0))}}c.debug=!1,s.Timer=c;class d{constructor(){this.A=d.PAD_OFF,this.B=d.PAD_OFF,this.START=d.PAD_OFF,this.SELECT=d.PAD_OFF,this.UP=d.PAD_OFF,this.DOWN=d.PAD_OFF,this.LEFT=d.PAD_OFF,this.RIGHT=d.PAD_OFF}}d.PAD_ON=0,d.PAD_OFF=1,s.GamePadButton=d;class l{constructor(){this.player=new Array(l.MAX_PLAYER);for(let t=0;t<l.MAX_PLAYER;t++)this.player[t]=new d;this.playersel=0,this.buttonsel=0}read(t){if(0==this.buttonsel){return 255&(this.player[this.playersel].A<<1|this.player[this.playersel].B|this.player[this.playersel].START<<3|this.player[this.playersel].SELECT<<2)}return 255&(this.player[this.playersel].UP|this.player[this.playersel].DOWN<<2|this.player[this.playersel].LEFT<<3|this.player[this.playersel].RIGHT<<1)}write(t,s){this.buttonsel=1&s,l.debug&&console.log("[GamePad] write "+h.hex(t)+":"+h.hex(s))}}l.MAX_PLAYER=4,l.debug=!1,s.GamePad=l;class _{constructor(){this.irq2=0,this.irq1=0,this.timer=0,this.irq2pend=0,this.irq1pend=0,this.timerpend=0}read(t){let s=0;switch(t){case 2:return s=this.irq2|this.irq1<<1|this.timer<<2;case 3:return s=this.irq2pend|this.irq1pend<<1|this.timerpend<<2}}write(t,s){let i="[Interrupt Mask] write @"+t+" ";switch(t){case 2:this.irq2=1&s,this.irq1=(2&s)>>1,this.timer=(4&s)>>2,i+="irq2="+this.irq2+" irq1="+this.irq1+" timer="+this.timer}_.debug&&console.log(i)}}_.debug=!1,s.InterruptMask=_;class o{constructor(){this.r=0,this.g=0,this.b=0}set(t,s,i){this.r=t,this.g=s,this.b=i}get_text(){return"R"+this.r+" G"+this.g+" B"+this.b}}s.Color=o;class n{constructor(){this.palette=new Array(n.PALETTE_SIZE),this.reset()}reset(){this.addrh=0,this.addrl=0,this.colorh=0,this.colorl=0,this.addr=0;for(let t=0;t<n.PALETTE_SIZE;t++)this.palette[t]=new o}read(t){return 0}write(t,s){switch(t){case 0:0==s&&this.reset(),this.colorburst=(8&s)>>7,this.filter=(4&s)>>2,this.freq=3&s,n.debug&&console.log("[Pal] burst "+this.colorburst+" filter "+this.filter+" freq "+this.freq);break;case 2:this.addrl=s,this.addr=511&(this.addrh<<8|this.addrl);break;case 3:this.addrh=s,this.addr=511&(this.addrh<<8|this.addrl);break;case 4:this.colorl=s;break;case 5:this.colorh=s;let i=(56&this.colorl)>>3<<5,e=((1&this.colorh)<<2|(192&this.colorl)>>6)<<5,h=(7&this.colorl)<<5;this.palette[this.addr].set(i,e,h),n.debug&&console.log("[Pal] writing "+this.palette[this.addr].get_text()+" @"+this.addr),this.addr=this.addr+1&511}}get_color(t){return this.palette[t]}}n.PALETTE_SIZE=512,n.debug=!1,s.Pal=n;class f{constructor(){this.ypos=0,this.xpos=0,this.saddr=0,this.yflip=0,this.xflip=0,this.ysize=0,this.xsize=0,this.fg=0,this.pal=0}}s.Sprite=f;class p{constructor(){this.satb_addr=0,this.memory=new Array(p.VRAM_SIZE),this.memory.fill(0),this.bitmap=new Array(p.PALBITMAP_SIZE),this.bitmap.fill(0),this.sprites=new Array(p.SPRITE_SIZE);for(let t=0;t<p.SPRITE_SIZE;t++)this.sprites[t]=new f;this.vram_raddr=0,this.vram_waddr=0,this.vram_value=0,this.iaddr=0,this.status_dma_inprogrss=0,this.status_vblank=0,this.status_vdma_complete=0,this.status_satb_dma_complete=0,this.status_hblank=0,this.status_sprite_overflow=0,this.status_sprite0_collision=0,this.datal=0,this.datah=0,this.control_incr=0,this.control_bg_enable=0,this.control_sprite_enable=0,this.control_int_vblank=0,this.control_int_hblank=0,this.control_int_sprite_overflow=0,this.control_int_sprite0_collision=0,this.rcr=0,this.bxr=0,this.byr=0,this.mwr_size_w=0,this.mwr_size_h=0,this.hsr_start=0,this.hsr_width=0,this.hdr_end=0,this.hdr_width=0,this.vpr_start=0,this.vpr_width=0,this.vdw_width=0,this.vcr_width=0,this.dcr_satb_auto=0,this.dcr_vdma_dest_dec=0,this.dcr_vdma_src_dec=0,this.dcr_vdma_complete=0,this.dcr_satb_dma_complete=0,this.dma_src=0,this.dma_dest=0,this.dma_len=0,this.satb_addr=0,this.vsync_counter=0,this.vsync_interrupt=!1,this.debug_vsync_called=0,this.latchl=new Array(20),this.latchl.fill(0),this.latchh=new Array(20),this.latchh.fill(0),this.skip_left=0,this.readlatch=0,this.writelatch=0}dump_get_text(){return"GPU\nRCR "+("    "+this.rcr).slice(-4)+" BXR "+("    "+this.bxr).slice(-4)+" BYR "+("    "+this.byr).slice(-4)+" MWR "+("    "+this.mwr_size_w).slice(-4)+"x"+("    "+this.mwr_size_h).slice(-4)+"\nHSR "+("    "+this.hsr_start).slice(-4)+"/ "+("    "+this.hsr_width).slice(-4)+" HDR "+("    "+this.hdr_end).slice(-4)+"/ "+("    "+this.hdr_width).slice(-4)+" VPR "+("    "+this.vpr_start).slice(-4)+"/ "+("    "+this.vpr_width).slice(-4)+" VDW "+("    "+this.vdw_width).slice(-4)+" VCR "+("    "+this.vcr_width).slice(-4)}read(t){let s="[GPU] reading @"+t+" ";switch(t){case 0:let i=this.status_dma_inprogrss<<6|this.status_vblank<<5|this.status_vdma_complete<<4|this.status_satb_dma_complete<<3|this.status_hblank<<2|this.status_sprite_overflow<<1|this.status_sprite0_collision;return this.status_vblank=0,this.status_hblank=0,this.status_satb_dma_complete=0,this.status_vdma_complete=0,p.debug&&console.log(s+"="+h.hex(i,2)),i;case 2:return 2==this.iaddr?255&this.readlatch:this.latchl[this.iaddr];case 3:if(2==this.iaddr){let t=(65280&this.readlatch)>>8;return this.vram_raddr=this.vram_raddr+this.control_incr,this.readlatch=this.memory[this.vram_raddr],s+="(vram read "+h.hex(this.readlatch,4)+" @ "+h.hex(this.vram_raddr,4)+")",p.debug&&console.log(s),t}return this.latchh[this.iaddr]}return 0}write(t,s){let i="[GPU] writing "+h.hex(s)+"@"+t+" ";switch(p.debug&&console.log(i),t){case 0:this.iaddr=s;break;case 2:this.datal=s,this.latchl[this.iaddr]=s,this.latchh[this.iaddr]=0,this.internal_write(this.iaddr,!1);break;case 3:this.datah=s,this.latchh[this.iaddr]=s,this.internal_write(this.iaddr,!0)}}internal_write(t,s){let i="[GPU Internal/write]",e=this.latchh[this.iaddr]<<8|this.latchl[this.iaddr];switch(this.iaddr){case 0:this.vram_waddr=e;break;case 1:this.vram_raddr=e,s&&(this.readlatch=this.memory[this.vram_raddr],i+="(vram read "+h.hex(this.readlatch,4)+" @ "+h.hex(this.vram_raddr,4)+")");break;case 2:s?(this.writelatch=255&this.writelatch|this.datah<<8,this.memory[this.vram_waddr]=this.writelatch,i+="(vram write "+h.hex(this.writelatch,4)+" @ "+h.hex(this.vram_waddr,4)+")",this.vram_waddr=this.vram_waddr+this.control_incr&32767):this.writelatch=65280&this.writelatch|this.datal;break;case 5:switch((6144&e)>>11){case 0:this.control_incr=1;break;case 1:this.control_incr=32;break;case 2:this.control_incr=64;break;case 3:this.control_incr=128}this.control_bg_enable=(128&e)>>7,this.control_sprite_enable=(64&e)>>6,this.control_int_vblank=(8&e)>>3,this.control_int_hblank=(4&e)>>2,this.control_int_sprite_overflow=(2&e)>>1,this.control_int_sprite0_collision=1&e,i+="(incr "+this.control_incr+" bgenable "+this.control_bg_enable+" spenable "+this.control_sprite_enable+" vblank "+this.control_int_vblank+" hblank "+this.control_int_hblank+" spovfl "+this.control_int_sprite_overflow+" sp0col "+this.control_int_sprite0_collision+")";break;case 6:this.rcr=1023&e,i+="(rcr  "+this.rcr+")";break;case 7:this.bxr=1023&e,i+="(bxr  "+this.bxr+")";break;case 8:this.byr=511&e,i+="(byr  "+this.byr+")";break;case 9:switch((112&e)>>4){case 0:this.mwr_size_w=32,this.mwr_size_h=32;break;case 1:this.mwr_size_w=64,this.mwr_size_h=32;break;case 2:case 3:this.mwr_size_w=128,this.mwr_size_h=32;break;case 4:this.mwr_size_w=32,this.mwr_size_h=64;break;case 5:this.mwr_size_w=64,this.mwr_size_h=64;break;case 6:case 7:this.mwr_size_w=128,this.mwr_size_h=64}i+="(mwr  "+this.mwr_size_w+"x"+this.mwr_size_h+")";break;case 10:this.hsr_start=(32512&e)>>8,this.hsr_width=31&e,i+="(hsr  "+this.hsr_start+"/"+this.hsr_width+")";break;case 11:this.hdr_end=(32512&e)>>8,this.hdr_width=63&e,i+="(hdr  "+this.hdr_end+"/"+this.hdr_width+")";break;case 12:this.vpr_start=(32512&e)>>8,this.vpr_width=31&e,i+="(vpr  "+this.vpr_start+"/"+this.vpr_width+")";break;case 13:this.vdw_width=511&e,i+="(vdw  "+this.vdw_width+")";break;case 14:this.vcr_width=255&e,i+="(vcr  "+this.vcr_width+")";break;case 15:this.dcr_satb_auto=16&e,this.dcr_vdma_dest_dec=8&e,this.dcr_vdma_src_dec=4&e,this.dcr_vdma_complete=2&e,this.dcr_satb_dma_complete=1&e,i+="(dcr satb "+this.dcr_satb_auto+" vdma_dest_dec "+this.dcr_vdma_dest_dec+" vdma_src_dec "+this.dcr_vdma_src_dec+" vdma_vdma_cmplt "+this.dcr_vdma_complete+" vdma_satb_dma_cmplt "+this.dcr_satb_dma_complete+")";break;case 16:this.dma_src=e,i+="(dma src "+this.dma_src+")";break;case 17:this.dma_dest=e,i+="(dma dest "+this.dma_dest+")";break;case 18:this.dma_len=e,i+="(dma len "+this.dma_len+")",s&&this.dma_exec();break;case 19:this.satb_addr=e,i+="(satb addr "+this.satb_addr+")";break;default:i+="(illegal)"}p.debug&&console.log(i)}dma_exec(){let t=this.dma_src,s=1==this.dcr_vdma_src_dec?-1:1,i=this.dma_dest,e=1==this.dcr_vdma_dest_dec?-1:1;for(let h=0;h<this.dma_len;h++)this.memory[i]=this.memory[t],t=t+s+32768&32767,i=i+e+32768&32767}tile_decode(){let t,s,i,e,h,a,r,c=0,d=0,l=0,_=new Array(16);this.mwr_size_w;for(e=0;e<this.mwr_size_h;e++){for(i=0;i<this.mwr_size_w;i++){for(h=this.memory[c],c+=1,a=(61440&h)>>8,r=(4095&h)<<4,t=0;t<16;t++)_[t]=this.memory[r+t];for(s=0;s<8;s++)0!=(d=(32768&_[s])>>14|(128&_[s])>>7|(32768&_[s+8])>>12|(128&_[s+8])>>5)&&(this.bitmap[l+0]=a|d),0!=(d=(16384&_[s])>>13|(64&_[s])>>6|(16384&_[s+8])>>11|(64&_[s+8])>>4)&&(this.bitmap[l+1]=a|d),0!=(d=(8192&_[s])>>12|(32&_[s])>>5|(8192&_[s+8])>>10|(32&_[s+8])>>3)&&(this.bitmap[l+2]=a|d),0!=(d=(4096&_[s])>>11|(16&_[s])>>4|(4096&_[s+8])>>9|(16&_[s+8])>>2)&&(this.bitmap[l+3]=a|d),0!=(d=(2048&_[s])>>10|(8&_[s])>>3|(2048&_[s+8])>>8|(8&_[s+8])>>1)&&(this.bitmap[l+4]=a|d),0!=(d=(1024&_[s])>>9|(4&_[s])>>2|(1024&_[s+8])>>7|4&_[s+8])&&(this.bitmap[l+5]=a|d),0!=(d=(512&_[s])>>8|(2&_[s])>>1|(512&_[s+8])>>6|(2&_[s+8])<<1)&&(this.bitmap[l+6]=a|d),0!=(d=(256&_[s])>>7|1&_[s]|(256&_[s+8])>>5|(1&_[s+8])<<2)&&(this.bitmap[l+7]=a|d),l+=8*this.mwr_size_w;l=l-8*this.mwr_size_w*8+8}l=l-8*this.mwr_size_w+8*this.mwr_size_w*8}}sprite_satb_decode(){let t=this.satb_addr;for(let s=0;s<p.SPRITE_SIZE;s++){this.sprites[s].ypos=1023&this.memory[t],t+=1,this.sprites[s].xpos=1023&this.memory[t],t+=1,this.sprites[s].saddr=(2047&this.memory[t])<<5,t+=1;let i=this.memory[t];this.sprites[s].yflip=(32768&i)>>15,this.sprites[s].ysize=(12288&i)>>12,this.sprites[s].xflip=(2048&i)>>11,this.sprites[s].xsize=(256&i)>>8,this.sprites[s].fg=(128&i)>>7,this.sprites[s].pal=(15&i)<<4,t+=1}}sprite_pattern_decode(t){let s=8*this.mwr_size_w*this.mwr_size_h*8-1;for(let i=p.SPRITE_SIZE-1;i>=0;i--){if(this.sprites[i].fg!=t)continue;let e,h=(this.sprites[i].ysize+1)*(this.sprites[i].xsize+1),a=new Array(64*h);for(let t=0;t<64*h;t++)a[t]=this.memory[this.sprites[i].saddr+t];let r,c,d=0,l=0==this.sprites[i].xflip?1:-1,_=0==this.sprites[i].xflip?0:1,o=0==this.sprites[i].yflip?1:-1,n=0==this.sprites[i].yflip?0:1;for(let t=0;t<this.sprites[i].ysize+1;t++)for(let h=0;h<this.sprites[i].xsize+1;h++){for(let f=0;f<16;f++){for(let p=0;p<16;p++){let b=15-p,m=1<<b,g=(a[d]&m)>>b|(a[d+16]&m)>>b<<1|(a[d+32]&m)>>b<<2|(a[d+48]&m)>>b<<3;0!=g&&(r=this.sprites[i].xpos-32+this.bxr+_*(16*(this.sprites[i].xsize+1)-1)+(p+16*h)*l,c=this.sprites[i].ypos-64+this.byr+n*(16*(this.sprites[i].ysize+1)-1)+(f+16*t)*o,r>=0+this.bxr&&r<8*this.mwr_size_w+this.bxr&&c>=0+this.byr&&c<8*this.mwr_size_h+this.byr&&(e=c*this.mwr_size_w*8+r,this.bitmap[e&s]=this.sprites[i].pal|g|256))}d+=1}d=d-16+64}}}palbitmap_decode(){this.skip_left>0?this.skip_left--:(this.skip_left=p.FRAME_SKIP,this.bitmap.fill(0),this.sprite_satb_decode(),this.sprite_pattern_decode(0),this.tile_decode(),this.sprite_pattern_decode(1),this.debug_vsync_called++)}get_bitmap_index(t,s){let i=this.bitmap[s*this.mwr_size_w*8+t];return null==i&&console.log("get_bitmap_index "+t+","+s),i}vsync_count(t){let s=Math.floor(2*w.BASE_CLOCK/60);this.vsync_counter=this.vsync_counter+t,this.vsync_counter>=s&&(this.vsync_interrupt=!0,this.status_vblank=1,this.status_satb_dma_complete=1,this.status_vdma_complete=1,this.vsync_counter=this.vsync_counter-s)}}p.VRAM_SIZE=32768,p.PALBITMAP_W=1024,p.PALBITMAP_H=512,p.PALBITMAP_SIZE=p.PALBITMAP_W*p.PALBITMAP_H,p.SPRITE_SIZE=64,p.FRAME_SKIP=0,p.debug=!1,s.GPU=p;class b{constructor(){this.playback_enable=0,this.dda_enable=0,this.volume=0,this.vol_l=0,this.vol_r=0,this.freq=0,this.freq_low=0,this.freq_high=0,this.period=0,this.wavetable=new Array(b.WAVETABLE_SIZE),this.wavetable.fill(0),this.pointer=0,this.noise_freq=0,this.is_noise=0}freq_update(){this.period=this.freq_low|this.freq_high<<8,0==this.period&&(this.period=1),this.freq=b.BASE_CLOCK/(32*this.period)}wavetable_update(t){this.wavetable[this.pointer]=t,this.pointer=this.pointer+1&31}get_text(){let t=this.freq;return 1==this.is_noise&&(t=this.noise_freq),(0==this.playback_enable?"OFF ":"ON  ")+(0==this.dda_enable?"    ":"DDA ")+" V "+("  "+this.volume).slice(-2)+" L "+("  "+this.vol_l).slice(-2)+" R "+("  "+this.vol_r).slice(-2)+" freq "+(""+t).slice(0,6)+(0==this.is_noise?"      ":"(Noise) ")}}b.BASE_CLOCK=3579545,b.WAVETABLE_SIZE=32,s.Channel=b;class m{constructor(){this.channels=new Array(m.NUM_CHANNELS);for(let t=0;t<m.NUM_CHANNELS;t++)this.channels[t]=new b;this.mastervol_l=0,this.mastervol_r=0,this.current_channel=0,this.lfo_reset=0,this.lfo_operation=0}dump_get_text(){let t="PSG\n";t+="L "+("  "+this.mastervol_l).slice(-2)+" R "+("  "+this.mastervol_l).slice(-2)+" LFO Mode "+m.LFO_MODE_STRING[this.lfo_operation]+" freq "+("  "+this.lfo_freq).slice(0,3)+(1==this.lfo_reset?"RST ":"   ")+"\n";for(let s=0;s<m.NUM_CHANNELS;s++)t+="CH"+s+" "+this.channels[s].get_text()+"\n";return t}read(t){return 0}write(t,s){let i="[PSG] writing "+s+"@"+t+" ";switch(t){case 0:this.current_channel=s%6,i+="(Channel Select "+this.current_channel+")";break;case 1:this.mastervol_l=(240&s)>>4,this.mastervol_r=15&s,i+="(Master Volume "+this.mastervol_l+"/"+this.mastervol_r+")";break;case 2:this.channels[this.current_channel].freq_low=s,this.channels[this.current_channel].freq_update(),i+="(Freq low)";break;case 3:this.channels[this.current_channel].freq_high=15&s,this.channels[this.current_channel].freq_update(),i+="(Freq high)";break;case 4:let e=31&s;this.channels[this.current_channel].volume=e;let h=(192&s)>>6;switch(h){case 0:this.channels[this.current_channel].playback_enable=0;break;case 1:this.channels[this.current_channel].pointer=0;break;case 2:this.channels[this.current_channel].playback_enable=1;break;case 3:this.channels[this.current_channel].dda_enable=1}i+="(Channel Volume "+e+" mode"+h;break;case 5:let a=(240&s)>>4,r=15&s;this.channels[this.current_channel].vol_l=a,this.channels[this.current_channel].vol_r=r,i+="(Pan "+a+"/"+r+")";break;case 6:this.channels[this.current_channel].wavetable_update(s),i+="(Wavetable)";break;case 7:let c=b.BASE_CLOCK/(64*(31&s^31));this.channels[this.current_channel].noise_freq=c;let d=0!=(128&s);this.channels[this.current_channel].is_noise=d?1:0,i+="(Noise "+c+" enable="+d+")";break;case 8:this.lfo_freq=s;break;case 9:this.lfo_operation=3&s,this.lfo_reset=0!=(128&s)?1:0,i+="(LFO ctrl op="+this.lfo_operation+" mode="+this.lfo_reset+")"}m.debug&&console.log(i)}}m.NUM_CHANNELS=6,m.debug=!1,m.LFO_MODE_STOP=0,m.LFO_MODE_x1=1,m.LFO_MODE_x16=2,m.LFO_MODE_x256=3,m.LFO_MODE_STRING=["OFF ","x1  ","x16 ","x256"],s.PSG=m;class g{constructor(){this.timer=null,this.gamepad=null,this.mask=null,this.gpu=null,this.psg=null,this.pal=null}attach(t,s,i,e,h,a){this.timer=t,this.gamepad=s,this.mask=i,this.gpu=e,this.pal=h,this.psg=a}read(t){return 0==t||2==t||3==t?this.gpu.read(3&t):t>=1024&&t<=1031?this.pal.read(7&t):t>=2048&&t<=2057?this.psg.read(15&t):3072==t||3073==t?this.timer.read(3&t):4096==t?this.gamepad.read(0):5122==t||5123==t?this.mask.read(15&t):0}write(t,s){0==t||2==t||3==t?this.gpu.write(3&t,s):t>=1024&&t<=1031?this.pal.write(7&t,s):t>=2048&&t<=2057?this.psg.write(15&t,s):3072==t||3073==t?this.timer.write(3&t,s):4096==t?this.gamepad.write(0,s):5122!=t&&5123!=t||(this.mask.write(3&t,s),5123==t&&(this.timer.interrupt=!1))}}s.Hardware=g;class k{constructor(){this.MPR=[255,248,0,0,0,0,0,0],this.offset=0,this.bank=0,this.ram=null,this.rom=null,this.hardware=null,this.error=!1,this.errorLog=""}attach(t,s,i){this.rom=t,this.ram=s,this.hardware=i}reset(){this.MPR=[255,248,0,0,0,0,0,0]}regdump_get_text(){return"MPR "+h.hex(this.MPR[0])+" "+h.hex(this.MPR[1])+" "+h.hex(this.MPR[2])+" "+h.hex(this.MPR[3])+" "+h.hex(this.MPR[4])+" "+h.hex(this.MPR[5])+" "+h.hex(this.MPR[6])+" "+h.hex(this.MPR[7])}memdump_get_text(t,s=128){let i="";i+="Rom Size:"+h.hex(this.rom.length(),8)+" Ram size: "+h.hex(this.ram.length(),4)+"\n",i+=this.regdump_get_text()+"\nMem\n";let e=t;for(let a=0;a<s;a++)(e-t)%16==0&&(i+="\n"+h.hex(e,4)),i+=" "+h.hex(this.read(e)),e=e+1&65535;return i+="\n"}map(t){let s=t>>13&7;this.offset=8191&t,this.bank=this.MPR[s]}read(t){return this.map(t),this.bank<128?this.rom.read(8192*this.bank+this.offset):247==this.bank?0:248==this.bank?this.ram.read(this.offset):255==this.bank?this.hardware.read(this.offset):(this.errorLog="Error reading bank "+this.bank,void(this.error=!0))}write(t,s){this.map(t),this.bank<128?(this.errorLog="Error writing bank "+this.bank,this.error=!0):247==this.bank||(248==this.bank?this.ram.write(this.offset,s):255==this.bank?this.hardware.write(this.offset,s):(this.errorLog="Error writing bank "+this.bank,this.error=!0))}}s.MemoryController=k;class u{constructor(){this.breaking=!1,this.A=0,this.X=0,this.Y=0,this.PC=0,this.SP=255,this.P=0,this.Mem=null,this.error=!1,this.findopcode=0,this.findoccurmax=1,this.findoccur=0,this.breakaddr=0,this.abort=!1,this.ticks=1,this.cycleleft=0,this.debugstartticks=0,this.debugticks=0,this.debugticksenable=!1,this.currentaddr=0,this.current_opcode=0,this.infiniteloop=!1,this.infinite_addr=new Array(2),this.infinite_addr.fill(0),this.infinite_check_index=0,this.profile=new Array(256),this.profile.fill(0)}regdump_get_text(){return"Regs : A="+h.hex(this.A)+" X="+h.hex(this.X)+" Y="+h.hex(this.Y)+" PC="+h.hex(this.PC,4)+" SP="+h.hex(this.SP)+" P="+h.hex(this.P)}dump(){console.log("----------------------------------------"),console.log("ticks "+this.ticks),console.log(this.regdump_get_text()),console.log(this.Mem.memdump_get_text(this.PC))}dump_get_text(){return"----------------------------------------\nticks "+this.ticks+"\n"+this.regdump_get_text()+"\n"+this.Mem.memdump_get_text(this.PC)}attach(t){this.Mem=t}reset(){this.Mem.reset();let t=this.Mem.read(u.RESET_VECTOR),s=this.Mem.read(u.RESET_VECTOR+1);this.PC=s<<8|t,this.SP=255,this.clockspeed=u.CLOCKSPEED_HIGH}flagC0(){this.P=-2&this.P&255}flagC1(){this.P=1|this.P}flagC(){return 1&this.P}flagZ0(){this.P=-3&this.P&255}flagZ1(){this.P=2|this.P}flagZ(){return(2&this.P)>>1}flagI0(){this.P=-5&this.P&255}flagI1(){this.P=4|this.P}flagI(){return(4&this.P)>>2}flagD0(){this.P=-9&this.P&255}flagD1(){this.P=8|this.P}flagD(){return(8&this.P)>>3}flagB0(){this.P=-17&this.P&255}flagB1(){this.P=16|this.P}flagB(){return(16&this.P)>>4}flagT0(){this.P=-33&this.P&255}flagT1(){this.P=32|this.P}flagT(){return(32&this.P)>>5}flagV0(){this.P=-65&this.P&255}flagV1(){this.P=64|this.P}flagV(){return(64&this.P)>>6}flagN0(){this.P=-129&this.P&255}flagN1(){this.P=128|this.P}flagN(){return(128&this.P)>>7}show_profile(){for(let t=0;t<256;t++)console.log(h.hex(t,2)+":"+this.profile[t]),t%16==15&&console.log("\n")}cycle(t){this.cycleleft+=t}step(t=0){for(let s=0;s<t;s++){let t=this.cycleleft;if(this.subsystem_exec(t),this.exec(t),s=s+t-1,this.abort)return}}interrupt(t){this.infiniteloop=!1,this.push((65280&this.PC)>>8),this.push(255&this.PC),this.push(this.P);let s=this.Mem.read(t),i=this.Mem.read(t+1);this.PC=i<<8|s,this.flagT0(),this.flagB0(),this.flagD0(),this.flagI1(),this.cycle(8)}subsystem_exec(t=1){this.Mem.hardware.gpu.vsync_count(t),this.Mem.hardware.gpu.vsync_interrupt&&(this.Mem.hardware.gpu.vsync_interrupt=!1,this.Mem.hardware.gpu.palbitmap_decode(),0==this.flagI()&&0==this.Mem.hardware.mask.irq1&&(this.Mem.hardware.gpu.status_vblank=1,this.interrupt(u.IRQ1_VECTOR))),this.Mem.hardware.timer.exec(t),this.Mem.hardware.timer.interrupt&&(0==this.flagI()&&0==this.Mem.hardware.mask.timer&&this.interrupt(u.TIMER_VECTOR),this.Mem.hardware.timer.interrupt=!1)}exec(t=1){if(this.ticks=this.ticks+t,this.debugticksenable&&(this.debugticks=this.debugticks+t,this.debugticks>1e6&&(this.debugticks-=1e6,this.dump())),this.debugstartticks>0&&this.ticks>this.debugstartticks&&(u.debug=!0),this.cycleleft=this.cycleleft-t,!u.ignorecycle&&this.cycleleft>0)return this.cycleleft=this.cycleleft-1,!1;if(this.currentaddr=this.PC,this.current_opcode=this.Mem.read(this.PC),u.debugbreak&&(this.breaking||this.currentaddr==this.breakaddr)){if(this.breaking=!0,u.debug=!0,p.debug=!0,n.debug=!0,this.breakleft<=0)return this.abort=!0,void this.dump();this.breakleft--}if(u.debugfind&&this.current_opcode==this.findopcode&&(this.findoccur++,this.findoccurmax==this.findoccur))return this.abort=!0,void this.dump();if(!this.infiniteloop){switch(this.decode="undecoded",this.decode_raw=h.hex(this.current_opcode)+" ",this.PC=this.PC+1&65535,this.profile[this.current_opcode]++,this.current_opcode){case 105:this.ADC_imm();break;case 101:this.ADC_zp();break;case 117:this.ADC_zpx();break;case 114:this.ADC_ind();break;case 97:this.ADC_inx();break;case 113:this.ADC_iny();break;case 109:this.ADC_abs();break;case 125:this.ADC_abx();break;case 121:this.ADC_aby();break;case 41:this.AND_imm();break;case 37:this.AND_zp();break;case 53:this.AND_zpx();break;case 50:this.AND_ind();break;case 33:this.AND_inx();break;case 49:this.AND_iny();break;case 45:this.AND_abs();break;case 61:this.AND_abx();break;case 57:this.AND_aby();break;case 6:this.ASL_zp();break;case 22:this.ASL_zpx();break;case 14:this.ASL_abs();break;case 30:this.ASL_abx();break;case 10:this.ASL_acc();break;case 15:this.BBR(0);break;case 31:this.BBR(1);break;case 47:this.BBR(2);break;case 63:this.BBR(3);break;case 79:this.BBR(4);break;case 95:this.BBR(5);break;case 111:this.BBR(6);break;case 127:this.BBR(7);break;case 144:this.BCC();break;case 143:this.BBS(0);break;case 159:this.BBS(1);break;case 175:this.BBS(2);break;case 191:this.BBS(3);break;case 207:this.BBS(4);break;case 223:this.BBS(5);break;case 239:this.BBS(6);break;case 255:this.BBS(7);break;case 176:this.BCS();break;case 240:this.BEQ();break;case 137:this.BIT_imm();break;case 36:this.BIT_zp();break;case 52:this.BIT_zpx();break;case 44:this.BIT_abs();break;case 60:this.BIT_abx();break;case 48:this.BMI();break;case 208:this.BNE();break;case 16:this.BPL();break;case 128:this.BRA();break;case 0:this.BRK();break;case 68:this.BSR();break;case 112:this.BVS();break;case 80:this.BVC();break;case 24:this.CLC();break;case 98:this.CLA();break;case 216:this.CLD();break;case 88:this.CLI();break;case 184:this.CLV();break;case 194:this.CLY();break;case 130:this.CLX();break;case 224:this.CPX_imm();break;case 228:this.CPX_zp();break;case 236:this.CPX_abs();break;case 212:this.CSH();break;case 84:this.CSL();break;case 201:this.CMP_imm();break;case 197:this.CMP_zp();break;case 213:this.CMP_zpx();break;case 210:this.CMP_ind();break;case 193:this.CMP_inx();break;case 209:this.CMP_iny();break;case 205:this.CMP_abs();break;case 221:this.CMP_abx();break;case 217:this.CMP_aby();break;case 202:this.DEX();break;case 198:this.DEC_zp();break;case 214:this.DEC_zpx();break;case 206:this.DEC_abs();break;case 222:this.DEC_abx();break;case 58:this.DEC_acc();break;case 192:this.CPY_imm();break;case 196:this.CPY_zp();break;case 204:this.CPY_abs();break;case 73:this.EOR_imm();break;case 69:this.EOR_zp();break;case 85:this.EOR_zpx();break;case 82:this.EOR_ind();break;case 65:this.EOR_inx();break;case 81:this.EOR_iny();break;case 77:this.EOR_abs();break;case 93:this.EOR_abx();break;case 89:this.EOR_aby();break;case 230:this.INC_zp();break;case 246:this.INC_zpx();break;case 238:this.INC_abs();break;case 254:this.INC_abx();break;case 26:this.INC_acc();break;case 232:this.INX();break;case 136:this.DEY();break;case 200:this.INY();break;case 76:this.JMP_abs();break;case 108:this.JMP_ain();break;case 124:this.JMP_aix();break;case 32:this.JSR();break;case 169:this.LDA_imm();break;case 165:this.LDA_zp();break;case 181:this.LDA_zpx();break;case 178:this.LDA_ind();break;case 161:this.LDA_inx();break;case 177:this.LDA_iny();break;case 173:this.LDA_abs();break;case 189:this.LDA_abx();break;case 185:this.LDA_aby();break;case 162:this.LDX_imm();break;case 166:this.LDX_zp();break;case 182:this.LDX_zpy();break;case 174:this.LDX_abs();break;case 190:this.LDX_aby();break;case 160:this.LDY_imm();break;case 164:this.LDY_zp();break;case 180:this.LDY_zpx();break;case 172:this.LDY_abs();break;case 188:this.LDY_abx();break;case 70:this.LSR_zp();break;case 86:this.LSR_zpx();break;case 78:this.LSR_abs();break;case 94:this.LSR_abx();break;case 74:this.LSR_acc();break;case 9:this.ORA_imm();break;case 5:this.ORA_zp();break;case 21:this.ORA_zpx();break;case 18:this.ORA_ind();break;case 1:this.ORA_inx();break;case 17:this.ORA_iny();break;case 13:this.ORA_abs();break;case 29:this.ORA_abx();break;case 25:this.ORA_aby();break;case 234:this.NOP();break;case 72:this.PHA();break;case 8:this.PHP();break;case 218:this.PHX();break;case 90:this.PHY();break;case 104:this.PLA();break;case 40:this.PLP();break;case 250:this.PLX();break;case 122:this.PLY();break;case 38:this.ROL_zp();break;case 54:this.ROL_zpx();break;case 46:this.ROL_abs();break;case 62:this.ROL_abx();break;case 42:this.ROL_acc();break;case 7:this.RMB(0);break;case 23:this.RMB(1);break;case 39:this.RMB(2);break;case 55:this.RMB(3);break;case 71:this.RMB(4);break;case 87:this.RMB(5);break;case 103:this.RMB(6);break;case 119:this.RMB(7);break;case 102:this.ROR_zp();break;case 118:this.ROR_zpx();break;case 110:this.ROR_abs();break;case 126:this.ROR_abx();break;case 106:this.ROR_acc();break;case 64:this.RTI();break;case 96:this.RTS();break;case 34:this.SAX();break;case 66:this.SAY();break;case 233:this.SBC_imm();break;case 229:this.SBC_zp();break;case 245:this.SBC_zpx();break;case 242:this.SBC_ind();break;case 225:this.SBC_inx();break;case 241:this.SBC_iny();break;case 237:this.SBC_abs();break;case 253:this.SBC_abx();break;case 249:this.SBC_aby();break;case 248:this.SED();break;case 56:this.SEC();break;case 120:this.SEI();break;case 244:this.SET();break;case 3:this.ST0();break;case 19:this.ST1();break;case 35:this.ST2();break;case 135:this.SMB(0);break;case 151:this.SMB(1);break;case 167:this.SMB(2);break;case 183:this.SMB(3);break;case 199:this.SMB(4);break;case 215:this.SMB(5);break;case 231:this.SMB(6);break;case 247:this.SMB(7);break;case 133:this.STA_zp();break;case 149:this.STA_zpx();break;case 146:this.STA_ind();break;case 129:this.STA_inx();break;case 145:this.STA_iny();break;case 141:this.STA_abs();break;case 157:this.STA_abx();break;case 153:this.STA_aby();break;case 134:this.STX_zp();break;case 150:this.STX_zpy();break;case 142:this.STX_abs();break;case 132:this.STY_zp();break;case 148:this.STY_zpx();break;case 140:this.STY_abs();break;case 100:this.STZ_zp();break;case 116:this.STZ_zpx();break;case 156:this.STZ_abs();break;case 158:this.STZ_abx();break;case 243:this.TAI();break;case 2:this.SXY();break;case 83:this.TAM();break;case 170:this.TAX();break;case 168:this.TAY();break;case 227:this.TIA();break;case 195:this.TDD();break;case 211:this.TIN();break;case 115:this.TII();break;case 67:this.TMA();break;case 20:this.TRB_zp();break;case 28:this.TRB_abs();break;case 4:this.TSB_zp();break;case 12:this.TSB_abs();break;case 131:this.TST_zp();break;case 163:this.TST_zpx();break;case 147:this.TST_abs();break;case 179:this.TST_abx();break;case 186:this.TSX();break;case 138:this.TXA();break;case 152:this.TYA();break;case 154:this.TXS();break;default:this.decode="***** Error illegal opcode "+h.hex(this.currentaddr,4)+":"+h.hex(this.current_opcode),this.error=!0,console.log(this.decode),this.PC=this.PC-16,this.dump(),this.abort=!0}return this.infinite_addr[0]==this.PC||this.infinite_addr[1]?this.infiniteloop=!0:(this.infinite_addr[this.infinite_check_index]=this.PC,this.infinite_check_index=(this.infinite_check_index+1)%1),u.debug&&console.log("["+("0000000000"+this.ticks).slice(-10)+"]"+h.hex(this.currentaddr,4)+" "+this.decode+" ["+this.decode_raw+"]"),u.debug,!0}this.cycleleft+=u.infiniteskip}store_work(t){this.work_value=t,this.decode=""}read_work(){let t=this.Mem.read(this.work_addr);this.work_value=t,this.imm&&(this.decode+="#"+h.hex(t,2)),this.imm=!1}write_work(){let t=this.work_value;this.Mem.write(this.work_addr,t)}addr_imm(){this.work_addr=this.PC,this.PC=this.PC+1&65535,this.decode="imm ",this.imm=!0}addr_imm2(){let t=this.Mem.read(this.PC),s=this.Mem.read(this.PC+1);this.decode_raw+=h.hex(t)+" "+h.hex(s)+" ",this.work_addr=s<<8|t,this.PC=this.PC+2&65535,this.decode="imm "+h.hex(this.work_addr,4)}addr_zp(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=u.ZEROPAGEBASE+t;this.work_addr=s,this.decode="z"+h.hex(t)}addr_zpx(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=u.ZEROPAGEBASE+(t+this.X&255);this.work_addr=s,this.decode="z"+h.hex(t)+",X"}addr_zpy(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=u.ZEROPAGEBASE+(t+this.Y&255);this.work_addr=s,this.decode="z"+h.hex(t)+",Y"}addr_ind(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=u.ZEROPAGEBASE+t,i=this.Mem.read(s),e=this.Mem.read(s+1);this.work_addr=e<<8|i,this.decode="(z"+h.hex(t)+")"}addr_inx(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535;let s=u.ZEROPAGEBASE+(t+this.X&255);this.decode_raw+=h.hex(t)+" ";let i=this.Mem.read(s),e=this.Mem.read(s+1);this.work_addr=e<<8|i,this.decode="(z"+h.hex(t)+",X)"}addr_iny(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535;let s=u.ZEROPAGEBASE+t;this.decode_raw+=h.hex(t)+" ";let i=this.Mem.read(s),e=this.Mem.read(s+1);this.work_addr=(e<<8|i)+this.Y,this.decode="(z"+h.hex(t)+"),Y"}addr_abs(){let t=this.Mem.read(this.PC);this.decode_raw+=h.hex(t)+" ",this.PC=this.PC+1&65535;let s=this.Mem.read(this.PC);this.decode_raw+=h.hex(s)+" ",this.PC=this.PC+1&65535,this.work_addr=s<<8|t,this.decode="$"+h.hex(this.work_addr,4)}addr_ain(){let t=this.Mem.read(this.PC);this.decode_raw+=h.hex(t)+" ";let s=this.Mem.read(this.PC+1);this.decode_raw+=h.hex(s)+" ",this.PC=this.PC+2&65535;let i=s<<8|t;this.decode="$"+h.hex(i,4);let e=this.Mem.read(i),a=this.Mem.read(i+1);this.work_addr=a<<8|e}addr_aix(){let t=this.Mem.read(this.PC);this.decode_raw+=h.hex(t)+" ";let s=this.Mem.read(this.PC+1);this.decode_raw+=h.hex(s)+" ",this.PC=this.PC+2&65535;let i=(s<<8|t)+this.X;this.decode="$"+h.hex(i,4)+",X";let e=this.Mem.read(i),a=this.Mem.read(i+1);this.work_addr=a<<8|e}addr_abx(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(s)+" ",this.work_addr=(s<<8|t)+this.X,this.decode="$"+h.hex(this.work_addr,4)+",X"}addr_aby(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(s)+" ",this.work_addr=(s<<8|t)+this.Y,this.decode="$"+h.hex(this.work_addr,4)+",Y"}read_rr(){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ";let s=t>=128?t-256:t;this.work_rr=s,this.decode+="r"+this.work_rr}read_direct(t=1){let s=0,i=0;for(let e=0;e<t;e++){let t=this.Mem.read(this.PC);this.PC=this.PC+1&65535,this.decode_raw+=h.hex(t)+" ",s+=t*Math.pow(256,i),i+=1}return s}push(t){this.Mem.write(this.SP+u.STACKBASE,t),this.SP--,this.SP<0&&(this.SP=255)}pull(){return this.SP++,this.SP>255&&(this.SP=0),this.Mem.read(this.SP+u.STACKBASE)}ADC_imm(){this.addr_imm(),this.ADC(),this.cycle(2)}ADC_zp(){this.addr_zp(),this.ADC(),this.cycle(4)}ADC_zpx(){this.addr_zpx(),this.ADC(),this.cycle(4)}ADC_ind(){this.addr_ind(),this.ADC(),this.cycle(7)}ADC_inx(){this.addr_inx(),this.ADC(),this.cycle(7)}ADC_iny(){this.addr_iny(),this.ADC(),this.cycle(7)}ADC_abs(){this.addr_abs(),this.ADC(),this.cycle(5)}ADC_abx(){this.addr_abx(),this.ADC(),this.cycle(5)}ADC_aby(){this.addr_aby(),this.ADC(),this.cycle(5)}ADC(){this.read_work();let t,s=0;0==this.flagT()?t=this.A:(s=u.ZEROPAGEBASE+this.X,t=this.Mem.read(s));let i=t+this.work_value+(0==this.flagC()?0:1);0==(255&i)?this.flagZ1():this.flagZ0(),i>255?this.flagC1():this.flagC0(),0!=(128&i)?this.flagN1():this.flagN0(),i>=128?this.flagV1():this.flagV0(),0==this.flagT()?this.A=255&i:this.Mem.write(s,255&i),this.flagT0(),this.decode="ADC "+this.decode}AND_imm(){this.addr_imm(),this.AND(),this.cycle(2)}AND_zp(){this.addr_zp(),this.AND(),this.cycle(4)}AND_zpx(){this.addr_zpx(),this.AND(),this.cycle(4)}AND_ind(){this.addr_ind(),this.AND(),this.cycle(7)}AND_inx(){this.addr_inx(),this.AND(),this.cycle(7)}AND_iny(){this.addr_iny(),this.AND(),this.cycle(7)}AND_abs(){this.addr_abs(),this.AND(),this.cycle(5)}AND_abx(){this.addr_abx(),this.AND(),this.cycle(5)}AND_aby(){this.addr_aby(),this.AND(),this.cycle(5)}AND(){this.read_work();let t,s=0;0==this.flagT()?t=this.A:(s=u.ZEROPAGEBASE+this.X,t=this.Mem.read(s));let i=t&this.work_value;0==i?this.flagZ1():this.flagZ0(),0!=(128&i)?this.flagN1():this.flagN0(),0==this.flagT()?this.A=255&i:this.Mem.write(s,255&i),this.flagT0(),this.decode="AND "+this.decode}ASL_zp(){this.addr_zp(),this.read_work(),this.ASL(),this.write_work(),this.cycle(6)}ASL_zpx(){this.addr_zpx(),this.read_work(),this.ASL(),this.write_work(),this.cycle(6)}ASL_abs(){this.addr_abs(),this.read_work(),this.ASL(),this.write_work(),this.cycle(7)}ASL_abx(){this.addr_abx(),this.read_work(),this.ASL(),this.write_work(),this.cycle(7)}ASL_acc(){this.store_work(this.A),this.ASL(),this.A=this.work_value,this.cycle(2)}ASL(){let t=this.work_value<<1;this.flagT0(),0==(255&t)?this.flagZ1():this.flagZ0(),0!=(128&t)?this.flagN1():this.flagN0(),t>255?this.flagC1():this.flagC0(),this.work_value=255&t,this.decode="ASL"+this.decode}BBR(t){let s=1<<t;this.addr_zp(),this.read_work();let i=this.work_value;this.read_rr(),0==(i&s)&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BBR"+t+" "+this.decode,this.cycle(6)}BCC(){this.decode="",this.read_rr(),0==this.flagC()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BCC "+this.decode,this.cycle(2)}BBS(t){let s=1<<t;this.addr_zp(),this.read_work();let i=this.work_value;this.read_rr(),0!=(i&s)&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BBS"+t+" "+this.decode,this.cycle(6)}BCS(){this.decode="",this.read_rr(),0!=this.flagC()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BCS "+this.decode,this.cycle(2)}BEQ(){this.decode="",this.read_rr(),0!=this.flagZ()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BEQ "+this.decode,this.cycle(2)}BIT_imm(){this.addr_imm(),this.BIT(),this.cycle(2)}BIT_zp(){this.addr_zp(),this.BIT(),this.cycle(4)}BIT_zpx(){this.addr_zpx(),this.BIT(),this.cycle(4)}BIT_abs(){this.addr_abs(),this.BIT(),this.cycle(5)}BIT_abx(){this.addr_abx(),this.BIT(),this.cycle(5)}BIT(){this.read_work();let t=this.work_value&this.A;this.flagT0(),0==t?this.flagZ1():this.flagZ0(),0!=(128&this.work_value)?this.flagN1():this.flagN0(),0!=(64&this.work_value)?this.flagV1():this.flagV0(),this.decode="BIT "+this.decode}BMI(){this.decode="",this.read_rr(),0!=this.flagN()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BMI"+this.decode,this.cycle(2)}BNE(){this.decode="",this.read_rr(),0==this.flagZ()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BNE "+this.decode,this.cycleleft+=2}BPL(){this.decode="",this.read_rr(),0==this.flagN()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BPL"+this.decode,this.cycle(2)}BRA(){this.decode="",this.read_rr(),this.PC=this.PC+this.work_rr&65535,this.decode="BRA "+this.decode,this.flagT0(),this.cycle(4)}BRK(){this.decode="",this.PC++,this.push((65280&this.PC)>>8),this.push(255&this.PC),this.push(this.P);let t=this.Mem.read(u.IRQ2_VECTOR),s=this.Mem.read(u.IRQ2_VECTOR+1);this.PC=s<<8|t,this.flagT0(),this.flagB1(),this.flagD0(),this.flagI1(),this.decode="BRK "+this.decode,this.cycle(8)}BSR(){this.decode="",this.read_rr();let t=this.PC-1;this.push((65280&t)>>8),this.push(255&t),this.PC=this.PC+this.work_rr&65535,this.flagT0(),this.decode="BSR",this.cycle(8)}BVC(){this.read_rr(),0==this.flagV()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BVC",this.cycle(2)}BVS(){this.read_rr(),0!=this.flagV()&&(this.PC=this.PC+this.work_rr&65535),this.flagT0(),this.decode="BVS",this.cycle(2)}CLC(){this.flagC0(),this.flagT0(),this.decode="CLC",this.cycle(2)}CLA(){this.A=0,this.flagT0(),this.decode="CLA",this.cycle(2)}CLD(){this.flagD0(),this.flagT0(),this.decode="CLD",this.cycle(2)}CLI(){this.flagI0(),this.flagT0(),this.decode="CLI",this.cycle(2)}CLV(){this.flagV0(),this.flagT0(),this.decode="CLV",this.cycle(2)}CLY(){this.Y=0,this.flagT0(),this.decode="CLY",this.cycle(2)}CLX(){this.X=0,this.flagT0(),this.decode="CLX",this.cycle(2)}CPX_imm(){this.addr_imm(),this.CPX(),this.cycle(2)}CPX_zp(){this.addr_zp(),this.CPX(),this.cycle(4)}CPX_abs(){this.addr_abs(),this.CPX(),this.cycle(5)}CPX(){this.read_work();let t=this.X-this.work_value;this.flagT0(),0==t?this.flagZ1():this.flagZ0(),t<0?this.flagC0():this.flagC1(),0!=(t+256&128)?this.flagN1():this.flagN0(),this.decode="CPX "+this.decode}CSH(){this.clockspeed=u.CLOCKSPEED_HIGH,this.decode="CSH",this.cycle(0)}CSL(){this.clockspeed=u.CLOCKSPEED_LOW,this.decode="CSL",this.cycle(0)}CMP_imm(){this.addr_imm(),this.CMP(),this.cycle(2)}CMP_zp(){this.addr_zp(),this.CMP(),this.cycle(4)}CMP_zpx(){this.addr_zpx(),this.CMP(),this.cycle(4)}CMP_ind(){this.addr_ind(),this.CMP(),this.cycle(7)}CMP_inx(){this.addr_inx(),this.CMP(),this.cycle(7)}CMP_iny(){this.addr_iny(),this.CMP(),this.cycle(7)}CMP_abs(){this.addr_abs(),this.CMP(),this.cycle(5)}CMP_abx(){this.addr_abx(),this.CMP(),this.cycle(5)}CMP_aby(){this.addr_aby(),this.CMP(),this.cycle(5)}CMP(){this.read_work();let t=this.A-this.work_value;this.flagT0(),0==t?this.flagZ1():this.flagZ0(),t<0?this.flagC0():this.flagC1(),0!=(t+256&128)?this.flagN1():this.flagN0(),this.decode="CMP "+this.decode}DEX(){this.X--,this.flagT0(),0==this.X?this.flagZ1():this.flagZ0(),0!=(this.X+256&128)?this.flagN1():this.flagN0(),this.X=this.X+256&255,this.cycle(2),this.decode="DEX"}DEC_zp(){this.addr_zp(),this.read_work(),this.DEC(),this.write_work(),this.cycle(6)}DEC_zpx(){this.addr_zpx(),this.read_work(),this.DEC(),this.write_work(),this.cycle(6)}DEC_abs(){this.addr_abs(),this.read_work(),this.DEC(),this.write_work(),this.cycle(7)}DEC_abx(){this.addr_abx(),this.read_work(),this.DEC(),this.write_work(),this.cycle(7)}DEC_acc(){this.store_work(this.A),this.DEC(),this.A=this.work_value,this.cycle(2)}DEC(){let t=this.work_value-1;this.flagT0(),0==t?this.flagZ1():this.flagZ0(),0!=(t+256&128)?this.flagN1():this.flagN0(),this.work_value=t+256&255,this.decode="DEC "+this.decode}CPY_imm(){this.addr_imm(),this.CPY(),this.cycle(2)}CPY_zp(){this.addr_zp(),this.CPY(),this.cycle(4)}CPY_abs(){this.addr_abs(),this.CPY(),this.cycle(5)}CPY(){this.read_work();let t=this.Y-this.work_value;this.flagT0(),0==t?this.flagZ1():this.flagZ0(),t<0?this.flagC0():this.flagC1(),0!=(t+256&128)?this.flagN1():this.flagN0(),this.decode="CPY "+this.decode}EOR_imm(){this.addr_imm(),this.EOR(),this.cycle(2)}EOR_zp(){this.addr_zp(),this.EOR(),this.cycle(4)}EOR_zpx(){this.addr_zpx(),this.EOR(),this.cycle(4)}EOR_ind(){this.addr_ind(),this.EOR(),this.cycle(7)}EOR_inx(){this.addr_inx(),this.EOR(),this.cycle(7)}EOR_iny(){this.addr_iny(),this.EOR(),this.cycle(7)}EOR_abs(){this.addr_abs(),this.EOR(),this.cycle(5)}EOR_abx(){this.addr_abx(),this.EOR(),this.cycle(5)}EOR_aby(){this.addr_aby(),this.EOR(),this.cycle(5)}EOR(){this.read_work();let t,s=0;0==this.flagT()?t=this.A:(s=u.ZEROPAGEBASE+this.X,t=this.Mem.read(s));let i=t^this.work_value;0==i?this.flagZ1():this.flagZ0(),0!=(128&i)?this.flagN1():this.flagN0(),0==this.flagT()?this.A=255&i:this.Mem.write(s,255&i),this.flagT0(),this.decode="EOR "+this.decode}INC_zp(){this.addr_zp(),this.read_work(),this.INC(),this.write_work(),this.cycle(6)}INC_zpx(){this.addr_zpx(),this.read_work(),this.INC(),this.write_work(),this.cycle(6)}INC_abs(){this.addr_abs(),this.read_work(),this.INC(),this.write_work(),this.cycle(7)}INC_abx(){this.addr_abx(),this.read_work(),this.INC(),this.write_work(),this.cycle(7)}INC_acc(){this.store_work(this.A),this.INC(),this.A=this.work_value,this.cycle(2)}INC(){let t=this.work_value+1;this.flagT0(),0==(255&t)?this.flagZ1():this.flagZ0(),0!=(128&t)?this.flagN1():this.flagN0(),this.work_value=255&t,this.decode="INC "+this.decode}INX(){this.X++,this.flagT0(),0==(255&this.X)?this.flagZ1():this.flagZ0(),0!=(128&this.X)?this.flagN1():this.flagN0(),this.X=255&this.X,this.decode="INX",this.cycle(2)}DEY(){this.Y--,this.flagT0(),0==this.Y?this.flagZ1():this.flagZ0(),0!=(this.Y+256&128)?this.flagN1():this.flagN0(),this.Y=this.Y+256&255,this.decode="DEY",this.cycle(2)}INY(){this.Y++,this.flagT0(),256==this.Y?this.flagZ1():this.flagZ0(),0!=(128&this.Y)?this.flagN1():this.flagN0(),this.Y=255&this.Y,this.decode="INY",this.cycle(2)}JMP_abs(){this.addr_imm2(),this.JMP(),this.cycle(4)}JMP_ain(){this.addr_ain(),this.JMP(),this.cycle(7)}JMP_aix(){this.addr_aix(),this.JMP(),this.cycle(7)}JMP(){this.PC=this.work_addr,this.flagT0(),this.decode="JMP "+this.decode}JSR(){this.addr_imm2();let t=this.PC-1;this.push((65280&t)>>8),this.push(255&t),this.PC=this.work_addr,this.flagT0(),this.cycle(7),this.decode="JSR "+this.decode}LDA_imm(){this.addr_imm(),this.LDA(),this.cycle(2)}LDA_zp(){this.addr_zp(),this.LDA(),this.cycle(4)}LDA_zpx(){this.addr_zpx(),this.LDA(),this.cycle(4)}LDA_ind(){this.addr_ind(),this.LDA(),this.cycle(7)}LDA_inx(){this.addr_inx(),this.LDA(),this.cycle(7)}LDA_iny(){this.addr_iny(),this.LDA(),this.cycle(7)}LDA_abs(){this.addr_abs(),this.LDA(),this.cycle(5)}LDA_abx(){this.addr_abx(),this.LDA(),this.cycle(5)}LDA_aby(){this.addr_aby(),this.LDA(),this.cycle(5)}LDA(){this.read_work(),this.A=this.work_value,this.flagT0(),0==this.A?this.flagZ1():this.flagZ0(),0!=(128&this.A)?this.flagN1():this.flagN0(),this.decode="LDA "+this.decode}LDX_imm(){this.addr_imm(),this.LDX(),this.cycle(2)}LDX_zp(){this.addr_zp(),this.LDX(),this.cycle(4)}LDX_zpy(){this.addr_zpy(),this.LDX(),this.cycle(4)}LDX_abs(){this.addr_abs(),this.LDX(),this.cycle(5)}LDX_aby(){this.addr_aby(),this.LDX(),this.cycle(5)}LDX(){this.read_work(),this.X=this.work_value,this.flagT0(),0==this.X?this.flagZ1():this.flagZ0(),0!=(128&this.X)?this.flagN1():this.flagN0(),this.decode="LDX "+this.decode}LDY_imm(){this.addr_imm(),this.LDY(),this.cycle(2)}LDY_zp(){this.addr_zp(),this.LDY(),this.cycle(4)}LDY_zpx(){this.addr_zpx(),this.LDY(),this.cycle(4)}LDY_abs(){this.addr_abs(),this.LDY(),this.cycle(5)}LDY_abx(){this.addr_abx(),this.LDY(),this.cycle(5)}LDY(){this.read_work(),this.Y=this.work_value,this.flagT0(),0==this.Y?this.flagZ1():this.flagZ0(),0!=(128&this.Y)?this.flagN1():this.flagN0(),this.decode="LDY "+this.decode}LSR_zp(){this.addr_zp(),this.read_work(),this.LSR(),this.write_work(),this.cycle(6)}LSR_zpx(){this.addr_zpx(),this.read_work(),this.LSR(),this.write_work(),this.cycle(6)}LSR_abs(){this.addr_abs(),this.read_work(),this.LSR(),this.write_work(),this.cycle(7)}LSR_abx(){this.addr_abx(),this.read_work(),this.LSR(),this.write_work(),this.cycle(7)}LSR_acc(){this.store_work(this.A),this.LSR(),this.A=this.work_value,this.cycle(2)}LSR(){let t=this.work_value>>>1;this.flagT0(),0!=(1&this.work_value)?this.flagC1():this.flagC0(),0==(255&t)?this.flagZ1():this.flagZ0(),this.flagN0(),this.work_value=255&t,this.decode="LSR "+this.decode}ORA_imm(){this.addr_imm(),this.ORA(),this.cycle(2)}ORA_zp(){this.addr_zp(),this.ORA(),this.cycle(4)}ORA_zpx(){this.addr_zpx(),this.ORA(),this.cycle(4)}ORA_ind(){this.addr_ind(),this.ORA(),this.cycle(7)}ORA_inx(){this.addr_inx(),this.ORA(),this.cycle(7)}ORA_iny(){this.addr_iny(),this.ORA(),this.cycle(7)}ORA_abs(){this.addr_abs(),this.ORA(),this.cycle(5)}ORA_abx(){this.addr_abx(),this.ORA(),this.cycle(5)}ORA_aby(){this.addr_aby(),this.ORA(),this.cycle(5)}ORA(){this.read_work();let t,s=0;0==this.flagT()?t=this.A:(s=u.ZEROPAGEBASE+this.X,t=this.Mem.read(s));let i=t|this.work_value;0==i?this.flagZ1():this.flagZ0(),0!=(128&i)?this.flagN1():this.flagN0(),0==this.flagT()?this.A=255&i:this.Mem.write(s,255&i),this.flagT0(),this.decode="ORA "+this.decode}NOP(){this.decode="NOP",this.cycle(2)}PHA(){this.push(this.A),this.decode="PHA",this.cycle(3)}PHP(){this.push(this.P),this.decode="PHP",this.cycle(3)}PHX(){this.push(this.X),this.decode="PHX",this.cycle(3)}PHY(){this.push(this.Y),this.decode="PHY",this.cycle(3)}PLA(){this.A=this.pull(),0==(255&this.A)?this.flagZ1():this.flagZ0(),0!=(128&this.A)?this.flagN1():this.flagN0(),this.decode="PLA",this.cycle(4)}PLP(){this.P=this.pull(),this.decode="PLP",this.cycle(4)}PLX(){this.X=this.pull(),0==(255&this.X)?this.flagZ1():this.flagZ0(),0!=(128&this.X)?this.flagN1():this.flagN0(),this.decode="PLX",this.cycle(4)}PLY(){this.Y=this.pull(),0==(255&this.Y)?this.flagZ1():this.flagZ0(),0!=(128&this.Y)?this.flagN1():this.flagN0(),this.decode="PLY",this.cycle(4)}ROL_zp(){this.addr_zp(),this.read_work(),this.ROL(),this.write_work(),this.cycle(6)}ROL_zpx(){this.addr_zpx(),this.read_work(),this.ROL(),this.write_work(),this.cycle(6)}ROL_abs(){this.addr_abs(),this.read_work(),this.ROL(),this.write_work(),this.cycle(7)}ROL_abx(){this.addr_abx(),this.read_work(),this.ROL(),this.write_work(),this.cycle(7)}ROL_acc(){this.store_work(this.A),this.ROL(),this.A=this.work_value,this.cycle(2)}ROL(){let t=0==this.flagC()?0:1,s=128&this.work_value,i=this.work_value<<1|t;this.flagT0(),0!=s?this.flagC1():this.flagC0(),0==(255&i)?this.flagZ1():this.flagZ0(),0!=(128&i)?this.flagN1():this.flagN0(),this.work_value=255&i,this.decode="ROL"+this.decode}RMB(t){let s=255&~(1<<t);this.addr_zp(),this.read_work();let i=s&this.work_value;this.work_value=i,this.write_work(),this.flagT0(),this.cycle(7),this.decode="RMB"+t+" "+this.decode}ROR_zp(){this.addr_zp(),this.read_work(),this.ROR(),this.write_work(),this.cycle(6)}ROR_zpx(){this.addr_zpx(),this.read_work(),this.ROR(),this.write_work(),this.cycle(6)}ROR_abs(){this.addr_abs(),this.read_work(),this.ROR(),this.write_work(),this.cycle(7)}ROR_abx(){this.addr_abx(),this.read_work(),this.ROR(),this.write_work(),this.cycle(7)}ROR_acc(){this.store_work(this.A),this.ROR(),this.A=this.work_value,this.cycle(2)}ROR(){let t=0==this.flagC()?0:128,s=1&this.work_value,i=t|this.work_value>>>1;this.flagT0(),0!=s?this.flagC1():this.flagC0(),0==(255&i)?this.flagZ1():this.flagZ0(),0!=(128&i)?this.flagN1():this.flagN0(),this.work_value=255&i,this.decode="ROR"+this.decode}RTI(){let t=this.pull();this.P=t;let s=this.pull(),i=this.pull()<<8|s;this.PC=i,this.cycle(7),this.decode="RTI"}RTS(){let t=this.pull(),s=this.pull()<<8|t;this.PC=s+1,this.flagT0(),this.cycle(7),this.decode="RTS"}SAX(){let t=this.A;this.A=this.X,this.X=t,this.flagT0(),this.decode="SAX",this.cycle(3)}SAY(){let t=this.A;this.A=this.Y,this.Y=t,this.flagT0(),this.decode="SAY",this.cycle(3)}SBC_imm(){this.addr_imm(),this.SBC(),this.cycle(2)}SBC_zp(){this.addr_zp(),this.SBC(),this.cycle(4)}SBC_zpx(){this.addr_zpx(),this.SBC(),this.cycle(4)}SBC_ind(){this.addr_ind(),this.SBC(),this.cycle(7)}SBC_inx(){this.addr_inx(),this.SBC(),this.cycle(7)}SBC_iny(){this.addr_iny(),this.SBC(),this.cycle(7)}SBC_abs(){this.addr_abs(),this.SBC(),this.cycle(5)}SBC_abx(){this.addr_abx(),this.SBC(),this.cycle(5)}SBC_aby(){this.addr_aby(),this.SBC(),this.cycle(5)}SBC(){this.read_work();let t=0!=this.flagC()?0:1,s=this.A-this.work_value-t;this.flagT0(),s<0?this.flagC0():this.flagC1(),0==(s+256&255)?this.flagZ1():this.flagZ0(),0!=(s+256&128)?this.flagN1():this.flagN0(),s<-128||s>=128?this.flagV1():this.flagV0(),this.A=s+256&255,this.decode="SBC "+this.decode}SED(){this.flagD1(),this.decode="SED",this.cycle(2)}SEC(){this.flagC1(),this.decode="SEC",this.cycle(2)}SEI(){this.flagI1(),this.decode="SEI",this.cycle(2)}SET(){this.flagT1(),this.decode="SET",this.cycle(2)}ST0(){this.addr_imm(),this.read_work(),this.Mem.hardware.gpu.write(0,this.work_value),this.flagT0(),this.decode="ST0 "+this.decode,this.cycle(4)}ST1(){this.addr_imm(),this.read_work(),this.Mem.hardware.gpu.write(2,this.work_value),this.flagT0(),this.decode="ST1 "+this.decode,this.cycle(4)}ST2(){this.addr_imm(),this.read_work(),this.Mem.hardware.gpu.write(3,this.work_value),this.flagT0(),this.decode="ST2 "+this.decode,this.cycle(4)}SMB(t){let s=1<<t;this.addr_zp(),this.read_work();let i=s|this.work_value;this.work_value=i,this.write_work(),this.flagT0(),this.decode="SMB"+t+" "+this.decode,this.cycle(7)}STA_zp(){this.addr_zp(),this.STA(),this.cycle(4)}STA_zpx(){this.addr_zpx(),this.STA(),this.cycle(4)}STA_ind(){this.addr_ind(),this.STA(),this.cycle(7)}STA_inx(){this.addr_inx(),this.STA(),this.cycle(7)}STA_iny(){this.addr_iny(),this.STA(),this.cycle(7)}STA_abs(){this.addr_abs(),this.STA(),this.cycle(5)}STA_abx(){this.addr_abx(),this.STA(),this.cycle(5)}STA_aby(){this.addr_aby(),this.STA(),this.cycle(5)}STA(){this.work_value=this.A,this.write_work(),this.flagT0(),this.decode="STA "+this.decode}STX_zp(){this.addr_zp(),this.STX(),this.cycle(4)}STX_zpy(){this.addr_zpy(),this.STX(),this.cycle(4)}STX_abs(){this.addr_abs(),this.STX(),this.cycle(5)}STX(){this.work_value=this.X,this.write_work(),this.flagT0(),this.decode="STX "+this.decode}STY_zp(){this.addr_zp(),this.STY(),this.cycle(4)}STY_zpx(){this.addr_zpx(),this.STY(),this.cycle(4)}STY_abs(){this.addr_abs(),this.STY(),this.cycle(5)}STY(){this.work_value=this.Y,this.write_work(),this.flagT0(),this.decode="STY "+this.decode}STZ_zp(){this.addr_zp(),this.STZ(),this.cycle(4)}STZ_zpx(){this.addr_zpx(),this.STZ(),this.cycle(4)}STZ_abs(){this.addr_abs(),this.STZ(),this.cycle(5)}STZ_abx(){this.addr_abx(),this.STZ(),this.cycle(5)}STZ(){this.work_value=0,this.write_work(),this.flagT0(),this.decode="STZ "+this.decode}TAI(){let t=this.read_direct(2),s=this.read_direct(2),i=this.read_direct(2);0==i&&(i=65536),this.decode="TAI $"+h.hex(t,4)+" $"+h.hex(s,4)+" #"+h.hex(i,4);for(let e=0;e<i;e++){let i=this.Mem.read(t+(1&e));this.Mem.write(s,i),s++}this.flagT0(),this.cycle(6*i+17)}SXY(){let t=this.X;this.X=this.Y,this.Y=t,this.flagT0(),this.decode="SXY",this.cycle(3)}TAM(){this.addr_imm(),this.read_work();let t=1;for(let s=0;s<8;s++)0!=(this.work_value&t)&&(this.Mem.MPR[s]=this.A),t<<=1;this.decode="TAM "+this.decode,this.flagT0(),this.cycle(5)}TAX(){this.X=this.A,0==this.X?this.flagZ1():this.flagZ0(),0!=(128&this.X)?this.flagN1():this.flagN0(),this.flagT0(),this.decode="TAX",this.cycle(2)}TAY(){this.Y=this.A,0==this.Y?this.flagZ1():this.flagZ0(),0!=(128&this.Y)?this.flagN1():this.flagN0(),this.flagT0(),this.decode="TAY",this.cycle(2)}TIA(){let t=this.read_direct(2),s=this.read_direct(2),i=this.read_direct(2);0==i&&(i=65536),this.decode="TIA $"+h.hex(t,4)+" $"+h.hex(s,4)+" #"+h.hex(i,4);for(let e=0;e<i;e++){let i=this.Mem.read(t);this.Mem.write(s+(1&e),i),t++}this.flagT0(),this.cycle(6*i+17)}TDD(){let t=this.read_direct(2),s=this.read_direct(2),i=this.read_direct(2);0==i&&(i=65536),this.decode="TDD $"+h.hex(t,4)+" $"+h.hex(s,4)+" #"+h.hex(i,4);for(let e=0;e<i;e++){let i=this.Mem.read(t);this.Mem.write(s,i),t--,s--}this.flagT0(),this.cycle(6*i+17)}TIN(){let t=this.read_direct(2),s=this.read_direct(2),i=this.read_direct(2);0==i&&(i=65536),this.decode="TIN $"+h.hex(t,4)+" $"+h.hex(s,4)+" #"+h.hex(i,4);for(let e=0;e<i;e++){let i=this.Mem.read(t);this.Mem.write(s,i),t++}this.flagT0(),this.cycle(6*i+17)}TII(){let t=this.read_direct(2),s=this.read_direct(2),i=this.read_direct(2);0==i&&(i=65536),this.decode="TII $"+h.hex(t,4)+" $"+h.hex(s,4)+" #"+h.hex(i,4);for(let e=0;e<i;e++){let i=this.Mem.read(t);this.Mem.write(s,i),t++,s++}this.flagT0(),this.cycle(6*i+17)}TMA(){this.addr_imm(),this.read_work();let t=1;for(let s=0;s<8;s++)0!=(this.work_value&t)&&(this.A=this.Mem.MPR[s]),t<<=1;this.decode="TMA "+this.decode,this.flagT0(),this.cycle(4)}TRB_zp(){this.addr_zp(),this.TRB(),this.cycle(6)}TRB_abs(){this.addr_abs(),this.TRB(),this.cycle(7)}TRB(){this.read_work();let t=this.work_value&~this.A&255;0!=(128&this.work_value)?this.flagN1():this.flagN0(),0!=(64&this.work_value)?this.flagV1():this.flagV0(),this.flagT0(),0==t?this.flagZ1():this.flagZ0(),this.work_value=t,this.write_work(),this.decode="TRB "+this.decode}TSB_zp(){this.addr_zp(),this.TSB(),this.cycle(6)}TSB_abs(){this.addr_abs(),this.TSB(),this.cycle(7)}TSB(){this.read_work();let t=this.work_value|this.A;0!=(128&this.work_value)?this.flagN1():this.flagN0(),0!=(64&this.work_value)?this.flagV1():this.flagV0(),this.flagT0(),0==t?this.flagZ1():this.flagZ0(),this.work_value=t,this.write_work(),this.decode="TSB "+this.decode}TST_zp(){this.addr_imm(),this.read_work();let t=this.work_value;this.addr_zp(),this.TST(t),this.cycle(6)}TST_zpx(){this.addr_imm(),this.read_work();let t=this.work_value;this.addr_zpx(),this.TST(t),this.cycle(6)}TST_abs(){this.addr_imm(),this.read_work();let t=this.work_value;this.addr_abs(),this.TST(t),this.cycle(7)}TST_abx(){this.addr_imm(),this.read_work();let t=this.work_value;this.addr_abx(),this.TST(t),this.cycle(7)}TST(t){this.read_work();let s=t&this.work_value;0!=(128&this.work_value)?this.flagN1():this.flagN0(),0!=(64&this.work_value)?this.flagV1():this.flagV0(),this.flagT0(),0==s?this.flagZ1():this.flagZ0(),this.decode="TST "+this.decode}TSX(){this.X=this.SP,0==this.X?this.flagZ1():this.flagZ0(),0!=(128&this.X)?this.flagN1():this.flagN0(),this.flagT0(),this.decode="TSX",this.cycle(2)}TXA(){this.A=this.X,0==this.A?this.flagZ1():this.flagZ0(),0!=(128&this.A)?this.flagN1():this.flagN0(),this.flagT0(),this.decode="TXA",this.cycle(2)}TXS(){this.SP=this.X,this.flagT0(),this.decode="TXS",this.cycle(2)}TYA(){this.A=this.Y,0==this.A?this.flagZ1():this.flagZ0(),0!=(128&this.A)?this.flagN1():this.flagN0(),this.flagT0(),this.decode="TYA",this.cycle(2)}}u.ZEROPAGEBASE=8192,u.STACKBASE=8448,u.RESET_VECTOR=65534,u.NMI_VECTOR=65532,u.TIMER_VECTOR=65530,u.IRQ1_VECTOR=65528,u.IRQ2_VECTOR=65526,u.debug=!1,u.ignorecycle=!1,u.debugfind=!1,u.debugbreak=!1,u.infiniteskip=500,u.CLOCKSPEED_HIGH=7159090,u.CLOCKSPEED_LOW=u.CLOCKSPEED_HIGH/4,s.CPU=u;class w{constructor(){this.cpu=new u,this.mem=new k,this.ram=new r,this.rom=new a,this.hardware=new g,this.timer=new c,this.gamepad=new l,this.mask=new _,this.gpu=new p,this.pal=new n,this.psg=new m,this.hardware.attach(this.timer,this.gamepad,this.mask,this.gpu,this.pal,this.psg),this.mem.attach(this.rom,this.ram,this.hardware),this.cpu.attach(this.mem)}is_ready(){return null!=this.rom.memory}load(t){this.rom.attach(t),this.cpu.reset()}unload(){this.rom.memory=null}run(t){let s=Math.floor(2*w.BASE_CLOCK*t/1e3);this.cpu.step(s)}get_pixel(t,s){let i=this.gpu.get_bitmap_index(t,s),e=this.pal.get_color(i);return null==e&&console.log("index "+i+" "+t+"/"+s),e}fill_screen(t,s,i,e,h){let a,r,c=0,d=8*this.gpu.mwr_size_w-1,l=8*this.gpu.mwr_size_h-1;if(0!=d&&0!=l)for(let _=0;_<e;_++){a=this.gpu.byr+_+s,r=this.gpu.bxr+t;for(let t=0;t<i;t++){let t=this.gpu.get_bitmap_index(r&d,a&l);r+=1;let s=this.pal.get_color(t);h[c]=s.r,h[c+=1]=s.g,h[c+=1]=s.b,h[c+=1]=255,c+=1}}}gamepad_A_on(t=0){this.gamepad.player[t].A=d.PAD_ON}gamepad_A_off(t=0){this.gamepad.player[t].A=d.PAD_OFF}gamepad_B_on(t=0){this.gamepad.player[t].B=d.PAD_ON}gamepad_B_off(t=0){this.gamepad.player[t].B=d.PAD_OFF}gamepad_START_on(t=0){this.gamepad.player[t].START=d.PAD_ON}gamepad_START_off(t=0){this.gamepad.player[t].START=d.PAD_OFF}gamepad_SELECT_on(t=0){this.gamepad.player[t].SELECT=d.PAD_ON}gamepad_SELECT_off(t=0){this.gamepad.player[t].SELECT=d.PAD_OFF}gamepad_UP_on(t=0){this.gamepad.player[t].UP=d.PAD_ON}gamepad_UP_off(t=0){this.gamepad.player[t].UP=d.PAD_OFF}gamepad_DOWN_on(t=0){this.gamepad.player[t].DOWN=d.PAD_ON}gamepad_DOWN_off(t=0){this.gamepad.player[t].DOWN=d.PAD_OFF}gamepad_LEFT_on(t=0){this.gamepad.player[t].LEFT=d.PAD_ON}gamepad_LEFT_off(t=0){this.gamepad.player[t].LEFT=d.PAD_OFF}gamepad_RIGHT_on(t=0){this.gamepad.player[t].RIGHT=d.PAD_ON}gamepad_RIGHT_off(t=0){this.gamepad.player[t].RIGHT=d.PAD_OFF}}w.BASE_CLOCK=3579545,s.System=w}]);